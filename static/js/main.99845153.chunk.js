(this["webpackJsonpbundleviewer.octoprint.org"]=this["webpackJsonpbundleviewer.octoprint.org"]||[]).push([[0],{115:function(e,t,n){"use strict";n.r(t);var r=n(4),c=n(0),a=n(10),o=n.n(a),i=n(13),s=n(173),l=n(162),u=n(80),j=n(174),d=n(175),b=n(176),h=n(177),p=n(178),f=n(84),O=n(63),x=n(117),g=n(183),m=n(76),v=n.n(m),w=n(75),y=n.n(w);function k(e){var t=Object(c.useState)(e.darkMode),n=Object(i.a)(t,2),a=n[0],o=n[1];return Object(r.jsx)(g.a,{title:"Toggle dark mode",children:Object(r.jsx)(x.a,{onClick:function(){e.onChange(!a),o(!a)},color:"inherit",title:"Toggle Dark Mode",children:a?Object(r.jsx)(y.a,{}):Object(r.jsx)(v.a,{})})})}var S=n(14),C=n(184),R=n(77),I=n.n(R),N=Object(l.a)((function(e){return{grow:{flexGrow:1},url:{position:"relative",borderRadius:e.shape.borderRadius,backgroundColor:Object(S.c)(e.palette.common.white,.15),"&:hover":{backgroundColor:Object(S.c)(e.palette.common.white,.25)},marginRight:e.spacing(2),marginLeft:e.spacing(2),flexGrow:1},urlIcon:{padding:e.spacing(0,2),height:"100%",position:"absolute",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"},inputRoot:{color:"inherit",width:"100%"},inputInput:{padding:e.spacing(1,1,1,0),paddingLeft:"calc(1em + ".concat(e.spacing(4),"px)"),transition:e.transitions.create("width"),width:"100%"}}}));function U(e){var t=N(),n=Object(c.useState)(e.url),a=Object(i.a)(n,2),o=a[0],s=a[1];return Object(r.jsxs)("div",{className:t.url,children:[Object(r.jsx)("div",{className:t.urlIcon,children:Object(r.jsx)(I.a,{})}),Object(r.jsx)(C.a,{placeholder:"URL...",classes:{root:t.inputRoot,input:t.inputInput},onChange:function(e){s(e.target.value)},onKeyDown:function(t){"Enter"===t.key&&e.handleUrlChange(o)},defaultValue:e.url})]})}var L=n(168),E=n(179),F=n(182),P=n(167),G=n(166),M=n(165),_=n(78),B=n.n(_);function J(e){var t=Object(O.b)().enqueueSnackbar,n=Object(c.useState)(),a=Object(i.a)(n,2),o=a[0],s=a[1],l=window.location.origin+window.location.pathname+"?url="+encodeURIComponent(e.url),u=function(){s(!1)};return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(g.a,{title:"Get shareable link",children:Object(r.jsx)(x.a,{onClick:function(){s(!0)},color:"inherit",children:Object(r.jsx)(B.a,{})})}),Object(r.jsxs)(F.a,{open:o,onClose:u,fullWidth:!0,children:[Object(r.jsx)(M.a,{children:"Shareable link"}),Object(r.jsx)(G.a,{children:Object(r.jsx)(E.a,{value:l,InputProps:{readOnly:!0},onFocus:function(e){e.target.select()},fullWidth:!0})}),Object(r.jsxs)(P.a,{children:[navigator.share?Object(r.jsx)(L.a,{onClick:function(){navigator.share&&(navigator.share({title:document.title,url:l}),u())},children:"Share"}):null,navigator.clipboard?Object(r.jsx)(L.a,{onClick:function(){navigator.clipboard&&(navigator.clipboard.writeText(l),t("URL copied to clipboard!"),u())},children:"Copy"}):null,Object(r.jsx)(L.a,{onClick:u,children:"Close"})]})]})]})}var z=n(185),D=n(171),T=n(172),W=n(68),Z=n.n(W),A=n(170),q=n(180),V=n(169),K=n(81);function H(e){var t=e.content.split("\n"),n=t.length,c=Object(l.a)((function(e){return{log:{flexGrow:1,overflow:"auto",padding:0,"font-family":"'JetBrains Mono', 'Droid Sans Mono', monospace"},line:{"&::before":{content:"attr(data-linenumber)",display:"inline-block",width:"".concat(n.toString().length,"ch"),"text-align":"right","margin-right":"1em",color:e.palette.text.secondary}}}}))();return Object(r.jsx)("code",{className:c.log,children:Object(r.jsx)("pre",{children:Object(r.jsx)(K.a,{height:500,itemCount:n,itemSize:20,children:function(e){var n=e.index,a=e.style;return Object(r.jsx)("span",{style:a,children:Object(r.jsx)("span",{"data-linenumber":n+1,className:c.line,children:t[n]})})}})})})}function Q(e){var t=e.info.split("\n").filter((function(e){return""!==e.trim()})).map((function(e){var t=e.split(":",2),n=Object(i.a)(t,2);return{key:n[0],value:n[1]}}));return console.log(t),Object(r.jsx)("div",{children:t.map((function(e,t){return Object(r.jsxs)("div",{children:[Object(r.jsx)("strong",{children:e.key}),": ",e.value,Object(r.jsx)("br",{})]},e.key)}))})}var X=n(26),Y=n.n(X),$=n(48),ee=n(79),te=n.n(ee);function ne(e){return re.apply(this,arguments)}function re(){return(re=Object($.a)(Y.a.mark((function e(t){var n;return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{mode:"cors"});case 2:if(n=e.sent,console.log(n),n.ok){e.next=6;break}throw new Error("Could not load file from ".concat(t,": ").concat(n.status));case 6:return e.next=8,n.blob();case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ce(){return(ce=Object($.a)(Y.a.mark((function e(t){var n;return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ne(t);case 2:return n=e.sent,e.next=5,te.a.loadAsync(n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ae(){return(ae=Object($.a)(Y.a.mark((function e(t,n){return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.file(n);case 2:return e.t0=e.sent,e.abrupt("return",null!==e.t0);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function oe(){return(oe=Object($.a)(Y.a.mark((function e(t,n,r){return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=r||"arraybuffer",e.next=3,t.file(n).async(r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ie={loadRemote:ne,loadRemoteZip:function(e){return ce.apply(this,arguments)},containsFile:function(e,t){return ae.apply(this,arguments)},getFileContents:function(e,t,n){return oe.apply(this,arguments)}},se=Object(l.a)((function(e){return{}}));function le(e){var t=se(),n=Object(c.useState)(!0),a=Object(i.a)(n,2),o=a[0],s=a[1],l=Object(c.useState)(!0),u=Object(i.a)(l,2),j=u[0],d=u[1],b=Object(c.useState)(!1),h=Object(i.a)(b,2),p=h[0],O=h[1],x=Object(c.useState)(""),g=Object(i.a)(x,2),m=g[0],v=g[1],w=Object(c.useState)([]),y=Object(i.a)(w,2),k=y[0],S=y[1],C=Object(c.useRef)();Object(c.useEffect)((function(){if(e.url){if(console.log("loadedURL",C.current),e.url===C.current)return void console.log("Same URL");var t=function(e){return e.match(/^https:\/\/github\.com\/[a-zA-Z0-9_-]+\/[a-zA-Z0-9_-]+\/files\//)?e.replace("https://github.com","https://bundleviewer.octoprint.org/bundles"):e}(e.url);s(!0),d(!0),O(!1),ie.loadRemoteZip(t).then((function(e){C.current=t;var n=["octoprint.log","serial.log","terminal.txt","plugin_softwareupdate_console.log","plugin_pluginmanager_console.log"];ie.getFileContents(e,"systeminfo.txt","string").then((function(t){v(t),s(!1);var r=[],c={};n.forEach((function(t){var n=ie.getFileContents(e,t,"string").then((function(e){c[t]=e}));r.push(n)})),Promise.allSettled(r).then((function(){var e=[];n.forEach((function(t){c[t]&&e.push({log:t,content:c[t]})})),S(e),d(!1)}))})).catch((function(){O(!0)}))})).catch((function(){O(!0)}))}}),[e.url]);var R=function(){return p?Object(r.jsxs)(q.a,{severity:"error",children:[Object(r.jsx)(V.a,{children:"Error"}),"Could not load bundle, is the URL correct and pointing to an OctoPrint SystemInfo Bundle zipfile?"]}):o?Object(r.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:Object(r.jsx)(A.a,{})}):Object(r.jsxs)(z.a,{defaultExpanded:!0,children:[Object(r.jsx)(D.a,{expandIcon:Object(r.jsx)(Z.a,{}),"aria-controls":"panel-sysinfo-content",id:"panel-sysinfo-header",children:Object(r.jsx)(f.a,{className:t.heading,children:"System Information"})}),Object(r.jsx)(T.a,{children:Object(r.jsx)(Q,{info:m})})]})},I=function(){return o||p?null:j?Object(r.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:Object(r.jsx)(A.a,{})}):Object(r.jsx)("div",{children:k.map((function(e,n){return Object(r.jsxs)(z.a,{children:[Object(r.jsx)(D.a,{expandIcon:Object(r.jsx)(Z.a,{}),"aria-controls":"panel-log-"+n+"-content",id:"panel-log-"+n+"-header",children:Object(r.jsx)(f.a,{className:t.heading,children:e.log})}),Object(r.jsx)(T.a,{children:Object(r.jsx)(H,{log:e.log,content:e.content,language:"plain"})})]},e.log)}))})};return Object(r.jsxs)("div",{children:[Object(r.jsx)(R,{}),Object(r.jsx)(I,{})]})}function ue(){return Object(r.jsx)(f.a,{style:{display:"flex",justifyContent:"center"},children:"Please enter a bundle URL and press Enter."})}var je=Object(l.a)((function(e){return{root:{display:"flex",overflow:"auto"},grow:{flexGrow:1},offset:e.mixins.toolbar,content:{flexGrow:1,height:"calc(100vh + ".concat(e.mixins.toolbar,"px)"),overflow:"auto"},container:{paddingTop:e.spacing(4),paddingBottom:e.spacing(4)}}}));function de(e){var t=function(e,t){var n=Object(c.useState)((function(){try{var n=window.localStorage.getItem(e);return n?JSON.parse(n):t}catch(r){return console.log(r),t}})),r=Object(i.a)(n,2),a=r[0],o=r[1];return[a,function(t){try{var n=t instanceof Function?t(a):t;o(n),window.localStorage.setItem(e,JSON.stringify(n))}catch(r){console.log(r)}}]}("enableDarkMode",Object(s.a)("(prefers-color-scheme: dark)")),n=Object(i.a)(t,2),a=n[0],o=n[1],l=Object(c.useState)(e.url),x=Object(i.a)(l,2),g=x[0],m=x[1],v=a?"dark":"light",w=Object(u.a)({palette:{type:v}}),y=je(),S=function(){return g?Object(r.jsx)(le,{url:g}):Object(r.jsx)(ue,{})};return Object(r.jsx)(j.a,{theme:w,children:Object(r.jsx)(O.a,{children:Object(r.jsxs)("div",{className:y.root,children:[Object(r.jsx)(d.a,{}),Object(r.jsx)(b.a,{position:"fixed",className:y.appBar,children:Object(r.jsxs)(h.a,{children:[Object(r.jsx)(f.a,{variant:"h6",noWrap:!0,children:"OctoPrint Bundle Viewer"}),Object(r.jsx)(U,{url:g,handleUrlChange:function(e){m(e);var t=new URL(window.location);t.searchParams.set("url",g),window.history.pushState({},"",t)}}),Object(r.jsx)(J,{url:g}),Object(r.jsx)(k,{darkMode:a,onChange:function(){o(!a)}})]})}),Object(r.jsxs)("main",{className:y.content,children:[Object(r.jsx)("div",{className:y.offset}),Object(r.jsx)(p.a,{maxWidth:"lg",className:y.container,children:Object(r.jsx)(S,{})})]})]})})})}var be=window.location.search,he=new URLSearchParams(be).get("url","");console.log("URL",he),o.a.render(Object(r.jsx)(de,{url:null==he?"":he}),document.querySelector("#root"))}},[[115,1,2]]]);
//# sourceMappingURL=main.99845153.chunk.js.map