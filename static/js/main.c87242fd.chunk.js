(this["webpackJsonpbundleviewer.octoprint.org"]=this["webpackJsonpbundleviewer.octoprint.org"]||[]).push([[0],{85:function(e,t,n){"use strict";n.r(t);var r=n(2),c=n(0),a=n(15),o=n.n(a),i=n(9),s=n(121),l=n(116),u=n(57),j=n(122),d=n(123),b=n(124),p=n(125),f=n(126),h=n(89),O=n(130),x=n(53),g=n.n(x);function m(e){var t=Object(c.useState)(e.darkMode),n=Object(i.a)(t,2),a=n[0],o=n[1];return Object(r.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[Object(r.jsx)(g.a,{}),Object(r.jsx)(O.a,{checked:a,onChange:function(){e.onChange(!a),o(!a)}})]})}var v=n(14),y=n(129),w=n(55),S=n.n(w),k=Object(l.a)((function(e){return{grow:{flexGrow:1},url:{position:"relative",borderRadius:e.shape.borderRadius,backgroundColor:Object(v.b)(e.palette.common.white,.15),"&:hover":{backgroundColor:Object(v.b)(e.palette.common.white,.25)},marginRight:e.spacing(2),marginLeft:e.spacing(2),flexGrow:1},urlIcon:{padding:e.spacing(0,2),height:"100%",position:"absolute",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"},inputRoot:{color:"inherit",width:"100%"},inputInput:{padding:e.spacing(1,1,1,0),paddingLeft:"calc(1em + ".concat(e.spacing(4),"px)"),transition:e.transitions.create("width"),width:"100%"}}}));function C(e){var t=k(),n=Object(c.useState)(e.url),a=Object(i.a)(n,2),o=a[0],s=a[1];return Object(r.jsxs)("div",{className:t.url,children:[Object(r.jsx)("div",{className:t.urlIcon,children:Object(r.jsx)(S.a,{})}),Object(r.jsx)(y.a,{placeholder:"URL...",classes:{root:t.inputRoot,input:t.inputInput},onChange:function(e){s(e.target.value)},onKeyDown:function(t){"Enter"===t.key&&e.handleUrlChange(o)},defaultValue:e.url})]})}var R=n(127),N=n(119),I=n(120),E=n(47),L=n.n(E),U=n(118),_=n(128),B=n(117),F=n(58);function G(e){var t=e.content.split("\n"),n=t.length,c=Object(l.a)((function(e){return{log:{flexGrow:1,overflow:"auto",padding:0,"font-family":"'JetBrains Mono', 'Droid Sans Mono', monospace"},line:{"&::before":{content:"attr(data-linenumber)",display:"inline-block",width:"".concat(n.toString().length,"ch"),"text-align":"right","margin-right":"1em",color:e.palette.text.secondary}}}}))();return Object(r.jsx)("code",{className:c.log,children:Object(r.jsx)("pre",{children:Object(r.jsx)(F.a,{height:500,itemCount:n,itemSize:20,children:function(e){var n=e.index,a=e.style;return Object(r.jsx)("span",{style:a,children:Object(r.jsx)("span",{"data-linenumber":n+1,className:c.line,children:t[n]})})}})})})}function J(e){var t=e.info.split("\n").filter((function(e){return""!==e.trim()})).map((function(e){var t=e.split(":",2),n=Object(i.a)(t,2);return{key:n[0],value:n[1]}}));return console.log(t),Object(r.jsx)("div",{children:t.map((function(e,t){return Object(r.jsxs)("div",{children:[Object(r.jsx)("strong",{children:e.key}),": ",e.value,Object(r.jsx)("br",{})]},e.key)}))})}var M=n(18),P=n.n(M),z=n(31),Z=n(56),A=n.n(Z);function D(e){return V.apply(this,arguments)}function V(){return(V=Object(z.a)(P.a.mark((function e(t){var n;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{mode:"cors"});case 2:if(n=e.sent,console.log(n),n.ok){e.next=6;break}throw new Error("Could not load file from ".concat(t,": ").concat(n.status));case 6:return e.next=8,n.blob();case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(){return(W=Object(z.a)(P.a.mark((function e(t){var n;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D(t);case 2:return n=e.sent,e.next=5,A.a.loadAsync(n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(){return(q=Object(z.a)(P.a.mark((function e(t,n){return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.file(n);case 2:return e.t0=e.sent,e.abrupt("return",null!==e.t0);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function K(){return(K=Object(z.a)(P.a.mark((function e(t,n,r){return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=r||"arraybuffer",e.next=3,t.file(n).async(r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var T={loadRemote:D,loadRemoteZip:function(e){return W.apply(this,arguments)},containsFile:function(e,t){return q.apply(this,arguments)},getFileContents:function(e,t,n){return K.apply(this,arguments)}},H=Object(l.a)((function(e){return{}}));function Q(e){var t=H(),n=Object(c.useState)(!0),a=Object(i.a)(n,2),o=a[0],s=a[1],l=Object(c.useState)(!0),u=Object(i.a)(l,2),j=u[0],d=u[1],b=Object(c.useState)(!1),p=Object(i.a)(b,2),f=p[0],O=p[1],x=Object(c.useState)(""),g=Object(i.a)(x,2),m=g[0],v=g[1],y=Object(c.useState)([]),w=Object(i.a)(y,2),S=w[0],k=w[1],C=Object(c.useRef)();Object(c.useEffect)((function(){if(e.url){if(console.log("loadedURL",C.current),e.url===C.current)return void console.log("Same URL");var t=function(e){return e.match(/^https:\/\/github\.com\/[a-zA-Z0-9_-]+\/[a-zA-Z0-9_-]+\/files\//)?e.replace("https://github.com","https://bundleviewer.octoprint.org/bundles"):e}(e.url);s(!0),d(!0),O(!1),T.loadRemoteZip(t).then((function(e){C.current=t;var n=["octoprint.log","serial.log","terminal.txt","plugin_softwareupdate_console.log","plugin_pluginmanager_console.log"];T.getFileContents(e,"systeminfo.txt","string").then((function(t){v(t),s(!1);var r=[],c={};n.forEach((function(t){var n=T.getFileContents(e,t,"string").then((function(e){c[t]=e}));r.push(n)})),Promise.allSettled(r).then((function(){var e=[];n.forEach((function(t){c[t]&&e.push({log:t,content:c[t]})})),k(e),d(!1)}))})).catch((function(){O(!0)}))})).catch((function(){O(!0)}))}}),[e.url]);var E=function(){return f?Object(r.jsxs)(_.a,{severity:"error",children:[Object(r.jsx)(B.a,{children:"Error"}),"Could not load bundle, is the URL correct and pointing to an OctoPrint SystemInfo Bundle zipfile?"]}):o?Object(r.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:Object(r.jsx)(U.a,{})}):Object(r.jsxs)(R.a,{defaultExpanded:!0,children:[Object(r.jsx)(N.a,{expandIcon:Object(r.jsx)(L.a,{}),"aria-controls":"panel-sysinfo-content",id:"panel-sysinfo-header",children:Object(r.jsx)(h.a,{className:t.heading,children:"System Information"})}),Object(r.jsx)(I.a,{children:Object(r.jsx)(J,{info:m})})]})},F=function(){return o||f?null:j?Object(r.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:Object(r.jsx)(U.a,{})}):Object(r.jsx)("div",{children:S.map((function(e,n){return Object(r.jsxs)(R.a,{children:[Object(r.jsx)(N.a,{expandIcon:Object(r.jsx)(L.a,{}),"aria-controls":"panel-log-"+n+"-content",id:"panel-log-"+n+"-header",children:Object(r.jsx)(h.a,{className:t.heading,children:e.log})}),Object(r.jsx)(I.a,{children:Object(r.jsx)(G,{log:e.log,content:e.content,language:"plain"})})]},e.log)}))})};return Object(r.jsxs)("div",{children:[Object(r.jsx)(E,{}),Object(r.jsx)(F,{})]})}function X(){return Object(r.jsx)(h.a,{style:{display:"flex",justifyContent:"center"},children:"Please enter a bundle URL and press Enter."})}var Y=Object(l.a)((function(e){return{root:{display:"flex",overflow:"auto"},grow:{flexGrow:1},offset:e.mixins.toolbar,content:{flexGrow:1,height:"calc(100vh + ".concat(e.mixins.toolbar,"px)"),overflow:"auto"},container:{paddingTop:e.spacing(4),paddingBottom:e.spacing(4)}}}));function $(e){var t=function(e,t){var n=Object(c.useState)((function(){try{var n=window.localStorage.getItem(e);return n?JSON.parse(n):t}catch(r){return console.log(r),t}})),r=Object(i.a)(n,2),a=r[0],o=r[1];return[a,function(t){try{var n=t instanceof Function?t(a):t;o(n),window.localStorage.setItem(e,JSON.stringify(n))}catch(r){console.log(r)}}]}("enableDarkMode",Object(s.a)("(prefers-color-scheme: dark)")),n=Object(i.a)(t,2),a=n[0],o=n[1],l=Object(c.useState)(e.url),O=Object(i.a)(l,2),x=O[0],g=O[1],v=a?"dark":"light",y=Object(u.a)({palette:{type:v}}),w=Y(),S=function(){return x?Object(r.jsx)(Q,{url:x}):Object(r.jsx)(X,{})};return Object(r.jsx)(j.a,{theme:y,children:Object(r.jsxs)("div",{className:w.root,children:[Object(r.jsx)(d.a,{}),Object(r.jsx)(b.a,{position:"fixed",className:w.appBar,children:Object(r.jsxs)(p.a,{children:[Object(r.jsx)(h.a,{variant:"h6",noWrap:!0,children:"OctoPrint Bundle Viewer"}),Object(r.jsx)(C,{url:x,handleUrlChange:function(e){g(e)}}),Object(r.jsx)(m,{darkMode:a,onChange:function(){o(!a)}})]})}),Object(r.jsxs)("main",{className:w.content,children:[Object(r.jsx)("div",{className:w.offset}),Object(r.jsx)(f.a,{maxWidth:"lg",className:w.container,children:Object(r.jsx)(S,{})})]})]})})}var ee=window.location.search,te=new URLSearchParams(ee).get("url","");console.log("URL",te),o.a.render(Object(r.jsx)($,{url:null==te?"":te}),document.querySelector("#root"))}},[[85,1,2]]]);
//# sourceMappingURL=main.c87242fd.chunk.js.map