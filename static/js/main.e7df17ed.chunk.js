(this["webpackJsonpbundleviewer.octoprint.org"]=this["webpackJsonpbundleviewer.octoprint.org"]||[]).push([[0],{120:function(e,t,n){"use strict";n.r(t);var r=n(4),a=n(0),c=n(10),o=n.n(c),i=n(14),s=n(23),l=n(170),u=n(167),j=n(83),d=n(181),b=n(182),p=n(179),h=n(180),f=n(183),O=n(87),x=n(122),g=n(187),m=n(82),v=n.n(m),w=n(66),y=n(189),k=n(78),S=n.n(k),C=n(77),R=n.n(C);function N(e){var t=Object(a.useState)(e.darkMode),n=Object(i.a)(t,2),c=n[0],o=n[1];return Object(r.jsx)(y.a,{title:"Toggle dark mode",children:Object(r.jsx)(x.a,{onClick:function(){e.onChange(!c),o(!c)},color:"inherit",children:c?Object(r.jsx)(R.a,{}):Object(r.jsx)(S.a,{})})})}var I=n(15),U=n(190),L=n(79),E=n.n(L),P=Object(u.a)((function(e){var t,n;return{grow:{flexGrow:1},url:(t={position:"relative",borderRadius:e.shape.borderRadius,backgroundColor:Object(I.c)(e.palette.common.white,.15),"&:hover":{backgroundColor:Object(I.c)(e.palette.common.white,.25)}},Object(s.a)(t,e.breakpoints.up("md"),{marginRight:e.spacing(2),marginLeft:e.spacing(2)}),Object(s.a)(t,"flexGrow",1),t),urlIcon:{padding:e.spacing(0,2),height:"100%",position:"absolute",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"},inputRoot:{color:"inherit",width:"100%"},inputInput:(n={padding:e.spacing(1,1,1,1)},Object(s.a)(n,e.breakpoints.up("md"),{paddingLeft:"calc(1em + ".concat(e.spacing(4),"px)")}),Object(s.a)(n,"transition",e.transitions.create("width")),Object(s.a)(n,"width","100%"),n)}}));function B(e){var t=P(),n=Object(a.useState)(e.url),c=Object(i.a)(n,2),o=c[0],s=c[1];return Object(r.jsxs)("div",{className:t.url,children:[Object(r.jsx)(g.a,{mdDown:!0,children:Object(r.jsx)("div",{className:t.urlIcon,children:Object(r.jsx)(E.a,{})})}),Object(r.jsx)(U.a,{placeholder:"URL...",classes:{root:t.inputRoot,input:t.inputInput},onChange:function(e){s(e.target.value)},onKeyDown:function(t){"Enter"===t.key&&e.handleUrlChange(o)},defaultValue:e.url})]})}var F=n(174),G=n(184),_=n(188),D=n(173),J=n(172),M=n(171),z=n(80),T=n.n(z);function W(e){var t=Object(w.b)().enqueueSnackbar,n=Object(a.useState)(),c=Object(i.a)(n,2),o=c[0],s=c[1],l=window.location.origin+window.location.pathname+"?url="+encodeURIComponent(e.url),u=function(){s(!1)};return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(y.a,{title:"Get shareable link",children:Object(r.jsx)(x.a,{onClick:function(){s(!0)},color:"inherit",children:Object(r.jsx)(T.a,{})})}),Object(r.jsxs)(_.a,{open:o,onClose:u,fullWidth:!0,children:[Object(r.jsx)(M.a,{children:"Shareable link"}),Object(r.jsx)(J.a,{children:Object(r.jsx)(G.a,{value:l,InputProps:{readOnly:!0},onFocus:function(e){e.target.select()},fullWidth:!0})}),Object(r.jsxs)(D.a,{children:[navigator.share?Object(r.jsx)(F.a,{onClick:function(){navigator.share&&(navigator.share({title:document.title,url:l}),u())},children:"Share"}):null,navigator.clipboard?Object(r.jsx)(F.a,{onClick:function(){navigator.clipboard&&(navigator.clipboard.writeText(l),t("URL copied to clipboard!"),u())},children:"Copy"}):null,Object(r.jsx)(F.a,{onClick:u,children:"Close"})]})]})]})}var Z=n(191),A=n(177),q=n(178),H=n(70),V=n.n(H),K=n(176),Q=n(185),X=n(175),Y=n(84);function $(e){var t=e.content.split("\n"),n=t.length,a=Object(u.a)((function(e){return{log:{flexGrow:1,overflow:"auto",padding:0,"font-family":"'JetBrains Mono', 'Droid Sans Mono', monospace"},line:{"&::before":{content:"attr(data-linenumber)",display:"inline-block",width:"".concat(n.toString().length,"ch"),"text-align":"right","margin-right":"1em",color:e.palette.text.secondary}}}}))();return Object(r.jsx)("code",{className:a.log,children:Object(r.jsx)("pre",{children:Object(r.jsx)(Y.a,{height:500,itemCount:n,itemSize:20,children:function(e){var n=e.index,c=e.style;return Object(r.jsx)("span",{style:c,children:Object(r.jsx)("span",{"data-linenumber":n+1,className:a.line,children:t[n]})})}})})})}function ee(e){var t=e.info.split("\n").filter((function(e){return""!==e.trim()})).map((function(e){var t=e.split(":",2),n=Object(i.a)(t,2);return{key:n[0],value:n[1]}}));return console.log(t),Object(r.jsx)("div",{children:t.map((function(e,t){return Object(r.jsxs)("div",{children:[Object(r.jsx)("strong",{children:e.key}),": ",e.value,Object(r.jsx)("br",{})]},e.key)}))})}var te=n(28),ne=n.n(te),re=n(51),ae=n(81),ce=n.n(ae);function oe(e){return ie.apply(this,arguments)}function ie(){return(ie=Object(re.a)(ne.a.mark((function e(t){var n;return ne.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{mode:"cors"});case 2:if(n=e.sent,console.log(n),n.ok){e.next=6;break}throw new Error("Could not load file from ".concat(t,": ").concat(n.status));case 6:return e.next=8,n.blob();case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function se(){return(se=Object(re.a)(ne.a.mark((function e(t){var n;return ne.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe(t);case 2:return n=e.sent,e.next=5,ce.a.loadAsync(n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function le(){return(le=Object(re.a)(ne.a.mark((function e(t,n){return ne.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.file(n);case 2:return e.t0=e.sent,e.abrupt("return",null!==e.t0);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ue(){return(ue=Object(re.a)(ne.a.mark((function e(t,n,r){return ne.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=r||"arraybuffer",e.next=3,t.file(n).async(r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var je={loadRemote:oe,loadRemoteZip:function(e){return se.apply(this,arguments)},containsFile:function(e,t){return le.apply(this,arguments)},getFileContents:function(e,t,n){return ue.apply(this,arguments)}},de=Object(u.a)((function(e){return{}}));function be(e){var t=de(),n=Object(a.useState)(!0),c=Object(i.a)(n,2),o=c[0],s=c[1],l=Object(a.useState)(!0),u=Object(i.a)(l,2),j=u[0],d=u[1],b=Object(a.useState)(!1),p=Object(i.a)(b,2),h=p[0],f=p[1],x=Object(a.useState)(""),g=Object(i.a)(x,2),m=g[0],v=g[1],w=Object(a.useState)([]),y=Object(i.a)(w,2),k=y[0],S=y[1],C=Object(a.useRef)();Object(a.useEffect)((function(){if(e.url){if(console.log("loadedURL",C.current),e.url===C.current)return void console.log("Same URL");var t=function(e){return e.match(/^https:\/\/github\.com\/[a-zA-Z0-9_-]+\/[a-zA-Z0-9_-]+\/files\//)?e.replace("https://github.com","https://bundleviewer.octoprint.org/bundles"):e}(e.url);s(!0),d(!0),f(!1),je.loadRemoteZip(t).then((function(e){C.current=t;var n=["octoprint.log","serial.log","terminal.txt","plugin_softwareupdate_console.log","plugin_pluginmanager_console.log"];je.getFileContents(e,"systeminfo.txt","string").then((function(t){v(t),s(!1);var r=[],a={};n.forEach((function(t){var n=je.getFileContents(e,t,"string").then((function(e){a[t]=e}));r.push(n)})),Promise.allSettled(r).then((function(){var e=[];n.forEach((function(t){a[t]&&e.push({log:t,content:a[t]})})),S(e),d(!1)}))})).catch((function(){f(!0)}))})).catch((function(){f(!0)}))}}),[e.url]);var R=function(){return h?Object(r.jsxs)(Q.a,{severity:"error",children:[Object(r.jsx)(X.a,{children:"Error"}),"Could not load bundle, is the URL correct and pointing to an OctoPrint SystemInfo Bundle zipfile?"]}):o?Object(r.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:Object(r.jsx)(K.a,{})}):Object(r.jsxs)(Z.a,{defaultExpanded:!0,children:[Object(r.jsx)(A.a,{expandIcon:Object(r.jsx)(V.a,{}),"aria-controls":"panel-sysinfo-content",id:"panel-sysinfo-header",children:Object(r.jsx)(O.a,{className:t.heading,children:"System Information"})}),Object(r.jsx)(q.a,{children:Object(r.jsx)(ee,{info:m})})]})},N=function(){return o||h?null:j?Object(r.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:Object(r.jsx)(K.a,{})}):Object(r.jsx)("div",{children:k.map((function(e,n){return Object(r.jsxs)(Z.a,{children:[Object(r.jsx)(A.a,{expandIcon:Object(r.jsx)(V.a,{}),"aria-controls":"panel-log-"+n+"-content",id:"panel-log-"+n+"-header",children:Object(r.jsx)(O.a,{className:t.heading,children:e.log})}),Object(r.jsx)(q.a,{children:Object(r.jsx)($,{log:e.log,content:e.content,language:"plain"})})]},e.log)}))})};return Object(r.jsxs)("div",{children:[Object(r.jsx)(R,{}),Object(r.jsx)(N,{})]})}function pe(){return Object(r.jsx)(O.a,{style:{display:"flex",justifyContent:"center"},children:"Please enter a bundle URL and press Enter."})}var he=Object(u.a)((function(e){var t;return{root:{display:"flex",overflow:"auto"},grow:{flexGrow:1},appBar:{},toolbar:Object(s.a)({},e.breakpoints.down("md"),{"justify-content":"flex-end","flex-wrap":"wrap"}),urlbar:Object(s.a)({flexGrow:1},e.breakpoints.down("md"),{"flex-basis":"100%",order:99,paddingBottom:e.spacing(2)}),title:{"justify-item":"left"},offset:e.mixins.toolbar,content:Object(s.a)({flexGrow:1,overflow:"auto","padding-top":e.mixins.toolbar.minHeight},e.breakpoints.down("md"),{"padding-top":2*e.mixins.toolbar.minHeight}),container:(t={paddingTop:e.spacing(4)},Object(s.a)(t,e.breakpoints.down("md"),{paddingTop:0}),Object(s.a)(t,"paddingBottom",e.spacing(4)),t)}}));function fe(e){var t=function(e,t){var n=Object(a.useState)((function(){try{var n=window.localStorage.getItem(e);return n?JSON.parse(n):t}catch(r){return console.log(r),t}})),r=Object(i.a)(n,2),c=r[0],o=r[1];return[c,function(t){try{var n=t instanceof Function?t(c):t;o(n),window.localStorage.setItem(e,JSON.stringify(n))}catch(r){console.log(r)}}]}("enableDarkMode",Object(l.a)("(prefers-color-scheme: dark)")),n=Object(i.a)(t,2),c=n[0],o=n[1],s=Object(a.useState)(e.url),u=Object(i.a)(s,2),m=u[0],y=u[1],k=c?"dark":"light",S=Object(j.a)({palette:{type:k}}),C=function(){o(!c)},R=function(e){y(e);var t=new URL(window.location);t.searchParams.set("url",m),window.history.pushState({},"",t)},I=he(),U=function(){return m?Object(r.jsx)(be,{url:m}):Object(r.jsx)(pe,{})},L=function(){return Object(r.jsx)(p.a,{className:I.appBar,children:Object(r.jsxs)(h.a,{className:I.toolbar,children:[Object(r.jsx)(g.a,{children:Object(r.jsx)(O.a,{variant:"h6",noWrap:!0,className:I.title,children:"OctoPrint Bundle Viewer"})}),Object(r.jsx)(g.a,{mdUp:!0,children:Object(r.jsx)("div",{className:I.grow})}),Object(r.jsx)("div",{className:I.urlbar,children:Object(r.jsx)(B,{url:m,handleUrlChange:R})}),Object(r.jsx)(W,{url:m}),Object(r.jsx)(N,{darkMode:c,onChange:C}),Object(r.jsx)(g.a,{xsDown:!0,children:Object(r.jsx)(x.a,{href:"https://github.com/OctoPrint/bundleviewer.octoprint.org",target:"_blank",children:Object(r.jsx)(v.a,{})})})]})})};return Object(r.jsx)(d.a,{theme:S,children:Object(r.jsx)(w.a,{children:Object(r.jsxs)("div",{className:I.root,style:{display:"flex"},children:[Object(r.jsx)(b.a,{}),Object(r.jsx)(L,{}),Object(r.jsx)("main",{className:I.content,children:Object(r.jsx)(f.a,{maxWidth:"lg",className:I.container,children:Object(r.jsx)(U,{})})})]})})})}var Oe=window.location.search,xe=new URLSearchParams(Oe).get("url","");console.log("URL",xe),o.a.render(Object(r.jsx)(fe,{url:null==xe?"":xe}),document.querySelector("#root"))}},[[120,1,2]]]);
//# sourceMappingURL=main.e7df17ed.chunk.js.map